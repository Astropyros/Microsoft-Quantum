name: Hosted Notebooks Samples Check

on:
  pull_request:
    branches: 
      - feature/samples-gallery
env:
  pipelineVars: '{''qcHash'': ''${{ github.sha }}'', ''githubRepo'': ''${{ github.repository }}'', ''prCommitHash'': ''${{ github.event.pull_request.head.sha }}'', ''isGithubPrBuild'': ''true'' }'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Print information
        run: |
          FILES=$(git diff origin/${{ github.event.pull_request.base.ref }} --name-only)
          FILE_URLS=""
          REGEX='\"download_url\": \"([^\"]*)\"'
          for file in $FILES; do
            echo "Getting download link for $file"
            RESPONSE=$(curl -H "Accept: application/vnd.github.v3+json" -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" https://api.github.com/repos/${{ github.repository }}/contents/$file?ref=${{ github.sha }})
            if [[ $RESPONSE =~ $REGEX ]]
            then
              FILE_URLS+=$BASH_REMATCH[1]
            fi
          done
          for file_url in $FILE_URLS; do
            echo $file_url
          done
